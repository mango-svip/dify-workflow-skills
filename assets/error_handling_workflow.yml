kind: app
version: 0.1.4
app:
  name: Error Handling Workflow
  description: Workflow demonstrating error handling with fail-branch and variable aggregator
  mode: workflow
  icon: ðŸ›¡ï¸
  icon_background: '#FFE5E5'
  use_icon_as_answer_icon: false
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      enabled: false
    opening_statement: ''
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
  graph:
    nodes:
      - id: '2000000000001'
        type: custom
        data:
          type: start
          title: Start
          desc: ''
          selected: false
          variables:
            - variable: input_data
              label: Input Data
              type: paragraph
              required: true
              max_length: 10000
        position:
          x: 100
          y: 250
        positionAbsolute:
          x: 100
          y: 250
        width: 244
        height: 90
        selected: false
        sourcePosition: right
        targetPosition: left
      - id: '2000000000002'
        type: custom
        data:
          type: code
          title: Process Data
          desc: ''
          selected: false
          code: |
            def main(input_data: str) -> dict:
                # This may fail if input is invalid
                result = json.loads(input_data)
                return {'output': result}
          code_language: python3
          error_strategy: fail-branch
          variables:
            - variable: input_data
              value_selector:
                - '2000000000001'
                - input_data
          outputs:
            output:
              type: object
              children: null
        position:
          x: 400
          y: 250
        positionAbsolute:
          x: 400
          y: 250
        width: 244
        height: 90
        selected: false
        sourcePosition: right
        targetPosition: left
      - id: '2000000000003'
        type: custom
        data:
          type: llm
          title: Error Handler
          desc: ''
          selected: false
          model:
            provider: anthropic
            name: claude-3-5-sonnet-20241022
            mode: chat
            completion_params:
              temperature: 0.7
          prompt_template:
            - id: error-handler-system
              role: system
              text: You are an error recovery assistant.
            - id: error-handler-user
              role: user
              text: 'Fix this error: {{#2000000000002.error_message#}} (Type: {{#2000000000002.error_type#}}). Original input: {{#2000000000001.input_data#}}'
          context:
            enabled: false
            variable_selector: []
          vision:
            enabled: false
        position:
          x: 700
          y: 400
        positionAbsolute:
          x: 700
          y: 400
        width: 244
        height: 98
        selected: false
        sourcePosition: right
        targetPosition: left
      - id: '2000000000004'
        type: custom
        data:
          type: code
          title: Retry Process
          desc: ''
          selected: false
          code: |
            def main(fixed_data: str) -> dict:
                result = json.loads(fixed_data)
                return {'output': result}
          code_language: python3
          variables:
            - variable: fixed_data
              value_selector:
                - '2000000000003'
                - text
          outputs:
            output:
              type: object
              children: null
        position:
          x: 1000
          y: 400
        positionAbsolute:
          x: 1000
          y: 400
        width: 244
        height: 90
        selected: false
        sourcePosition: right
        targetPosition: left
      - id: '2000000000005'
        type: custom
        data:
          type: variable-aggregator
          title: Merge Results
          desc: ''
          selected: false
          output_type: object
          variables:
            - - '2000000000002'
              - output
            - - '2000000000004'
              - output
        position:
          x: 1300
          y: 250
        positionAbsolute:
          x: 1300
          y: 250
        width: 244
        height: 90
        selected: false
        sourcePosition: right
        targetPosition: left
      - id: '2000000000006'
        type: custom
        data:
          type: end
          title: End
          desc: ''
          selected: false
          outputs:
            - variable: final_result
              value_selector:
                - '2000000000005'
                - output
        position:
          x: 1600
          y: 250
        positionAbsolute:
          x: 1600
          y: 250
        width: 244
        height: 90
        selected: false
        sourcePosition: right
        targetPosition: left
    edges:
      - id: 2000000000001-source-2000000000002-target
        source: '2000000000001'
        sourceHandle: source
        target: '2000000000002'
        targetHandle: target
        type: custom
        data:
          sourceType: start
          targetType: code
          isInIteration: false
        zIndex: 0
        selected: false
      - id: 2000000000002-source-2000000000005-target
        source: '2000000000002'
        sourceHandle: source
        target: '2000000000005'
        targetHandle: target
        type: custom
        data:
          sourceType: code
          targetType: variable-aggregator
          isInIteration: false
        zIndex: 0
        selected: false
      - id: 2000000000002-fail-branch-2000000000003-target
        source: '2000000000002'
        sourceHandle: fail-branch
        target: '2000000000003'
        targetHandle: target
        type: custom
        data:
          sourceType: code
          targetType: llm
          isInIteration: false
        zIndex: 0
        selected: false
      - id: 2000000000003-source-2000000000004-target
        source: '2000000000003'
        sourceHandle: source
        target: '2000000000004'
        targetHandle: target
        type: custom
        data:
          sourceType: llm
          targetType: code
          isInIteration: false
        zIndex: 0
        selected: false
      - id: 2000000000004-source-2000000000005-target
        source: '2000000000004'
        sourceHandle: source
        target: '2000000000005'
        targetHandle: target
        type: custom
        data:
          sourceType: code
          targetType: variable-aggregator
          isInIteration: false
        zIndex: 0
        selected: false
      - id: 2000000000005-source-2000000000006-target
        source: '2000000000005'
        sourceHandle: source
        target: '2000000000006'
        targetHandle: target
        type: custom
        data:
          sourceType: variable-aggregator
          targetType: end
          isInIteration: false
        zIndex: 0
        selected: false
  viewport:
    x: 0
    y: 0
    zoom: 0.8
